<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8"/>
        <title>Demo</title>
        <meta name="keywords" content=""/>
        <meta name="description" content="This is auto-generated by sublime-custom-insert"/>
        <meta name="revised" value="yanni4night,2015/11/27"/>
        <style type="text/css">
        </style>
    </head>
    <body>
    <div id="chart" style="height:400px;"></div>
    <div id="chart-res" style="height:400px;"></div>
    </body>
    <script src="jquery-2.1.4.min.js"></script>
    <script src="echarts-all.js"></script>
    <script type="text/javascript">
    var option = {
    title : {
        text: '页面加载性能分析'
    },
    tooltip : {
        show: false,
        trigger: 'axis'
    },
    legend: {
        data:[]
    },
    calculable : true,
    xAxis : [],
    yAxis : [
        {
            type : 'value',
            axisLabel : {
                formatter: '{value} ms'
            }
        }
    ],
    series : []
};
    var legends =['有广告的页面加载时间','无广告的页面加载时间']
    $.when($.getJSON('result-ad.json'), $.getJSON('result-noad.json'))
    .done(function(){
    var performances = Array.prototype.slice.apply(arguments).map(function(item){return item[0];});
       performances.forEach(function(performance,idx){
            var total = performance.map(function(item){
                return item.loadEventStart - item.navigationStart;
            }).filter(function(val){return val<1e4});
            option.legend.data.push(legends[idx]);
            option.series.push({
                name: legends[idx],
                type: 'line',
                data: total,
                markLine : {
                    data : [
                        {type : 'average', name: '平均值'}
                    ]
                }
            });
    
            var xAxisData =[];
    
            for (var i = 0; i < total.length; ++i) {
                xAxisData.push(1+i);
            }
    
            option.xAxis.push({
                    type : 'category',
                    boundaryGap : false,
                    data : xAxisData
                });
       });

        echarts.init($('#chart')[0]).setOption(option);
    });
    </script>
        <script type="text/javascript">
    var resOption = {
    title : {
        text: '广告加载性能分析'
    },
    tooltip : {
        show: false,
        trigger: 'axis'
    },
    legend: {
        data:['iframe广告']
    },
    calculable : true,
    xAxis : [],
    yAxis : [
        {
            type : 'value',
            axisLabel : {
                formatter: '{value} ms'
            }
        }
    ],
    series : []
};
$.getJSON('result-res.json').then(function(data){

    var xAxisData =[];

    data = data.map(function(item){return item.duration}).filter(function(d){return d>10});
    
            for (var i = 0; i < data.length; ++i) {
                xAxisData.push(1+i);
            }
    
            resOption.xAxis.push({
                    type : 'category',
                    boundaryGap : false,
                    data : xAxisData
                });

    resOption.series.push({
                name: resOption.legend.data[0],
                type: 'line',
                data: data,
                markLine : {
                    data : [
                        {type : 'average', name: '平均值'}
                    ]
                }
    });
    echarts.init($('#chart-res')[0]).setOption(resOption);
});
</script>
</html>